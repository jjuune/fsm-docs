# M-02 컴포넌트 구조 및 리스크 분석

## TL;DR
- **핵심 리스크:** 서명 패드 호환성, 대용량 사진 업로드, 실시간 자동 저장 UX
- **개발 우선순위:** 체크리스트 ➔ 서명 ➔ 완료 검증 ➔ 사진 업로드

---

## 🏗️ 1. 컴포넌트 계층 구조 (Component Tree)

- **WorkOrderDetailPage (Page)**
  - `StickyHeader`: 상태 배지 및 퀵 액션
  - `SiteCard`: 현장 정보 및 지도 연동
  - `ChecklistSection (Core)`: 점검 항목 및 FAIL 메모 제어
  - `SignatureSection (Core)`: 캔버스 기반 서명 및 이름 입력
  - `PhotoSection (Optional)`: 비동기 사진 업로드 및 미리보기
  - `StickyActionBar`: 최종 검증 및 제출 버튼

---

## 📊 2. 컴포넌트별 난이도 및 리스크 분석

| 컴포넌트 | 난이도 | 리스크 및 개발 주의사항 |
| :--- | :---: | :--- |
| **ChecklistSection** | **중간** | **Autosave 루프:** 저장 중 재입력 시 데이터 덮어쓰기 방지 처리 필수. |
| **SignatureSection** | **높음** | **모바일 터치 호환성:** iOS/Android 브라우저별 터치 이벤트 이격 현상 대응 필요. |
| **PhotoSection** | **중간** | **네트워크 타임아웃:** 현장 신호가 약할 때 대용량 업로드 실패에 대한 재시도 UX. |
| **StickyHeader/Footer** | **낮음** | **레이아웃 깨짐:** 모바일 가상 키보드 호출 시 하단 바 가림 현상 해결(Z-index/Position). |

---

## 🔥 3. 핵심 리스크 대응 전략

### 🎯 1) 서명 패드 (Signature Pad)
- **문제:** 빈 서명 제출 또는 저해상도 이미지.
- **대응:** 
  - 서명 선의 픽셀 감지로 '최소 데이터 존재' 여부 검증.
  - 레티나 디스플레이 대응을 위해 캔버스 해상도를 CSS 크기보다 2배 크게 렌더링.

### 🎯 2) 사진 업로드 안정성
- **문제:** 5MB 이상의 원본 사진 업로드 시 서버 부하 및 실패.
- **대응:**
  - **Client-side Resize:** 모바일에서 업로드 전 1024px~1600px 수준으로 리사이즈 권장.
  - **Async Upload:** 개별 사진 단위로 업로드 진행률 표시.

### 🎯 3) 에러 피드백
- **문제:** 네트워크 일시 단절로 인한 체크리스트 저장 누락.
- **대응:**
  - 각 항목별 `[Saved]`, `[Error]` 상태 표시 연동.
  - 치명적 오류 시 제출 버튼 비활성화 및 경고 토스트.

---

## 🏁 4. Phase 1 구현 로드맵
1. **[Sprint 1]:** 기본 레이아웃 및 체크리스트 CRUD (자동 저장 포함)
2. **[Sprint 2]:** 서명 섹션 구현 및 파일 업로드 연동
3. **[Sprint 3]:** 서버 사이드 완료 검증 로직 및 상태 전이 연동
4. **[Sprint 4]:** 사진 업로드 고도화 및 최종 안정화

---

## 연관 문서
- [기술 상세 명세](01-m02-spec.md)
- [API 가이드](03-api.md)

## 변경 이력
- **v0.1:** 컴포넌트 단위 분석 및 리스크 매핑 초안 (2025-02-20)
